# 🚀 CF AI Chat 部署说明

## 📋 部署步骤

### 第1步：Fork项目
1. 点击GitHub页面右上角的 **Fork** 按钮
2. 选择Fork到您的个人账户

### 第2步：创建KV存储
1. 登录 [Cloudflare Dashboard](https://dash.cloudflare.com)
2. 左侧菜单点击 **Workers & Pages**
3. 点击 **KV** 标签页
4. 点击 **Create a namespace**
5. 输入名称：`cf-ai-chat-history`
6. 点击 **Add**
7. **记录显示的命名空间ID**（类似：`1a2b3c4d5e6f7g8h9i0j1k2l3m4n5o6p`）

### 第3步：获取Cloudflare凭证

#### 获取API Token
1. 访问 [API Tokens页面](https://dash.cloudflare.com/profile/api-tokens)
2. 点击 **Create Token**
3. 选择 **Custom token**
4. 设置权限：
   ```
   Permissions:
   - Account: Cloudflare Workers:Edit
   - Zone: Zone Settings:Read
   - Zone: Zone:Read
   
   Account Resources:
   - Include: All accounts
   
   Zone Resources:
   - Include: All zones
   ```
5. 点击 **Continue to summary** → **Create Token**
6. **复制并保存Token**

#### 获取Account ID
1. 在Cloudflare Dashboard首页
2. 右侧栏找到 **Account ID**
3. 点击复制

### 第4步：配置GitHub Secrets
1. 进入您Fork的仓库
2. 点击 **Settings** 标签页
3. 左侧菜单 **Secrets and variables** → **Actions**
4. 点击 **New repository secret** 添加：

**Secret 1:**
- Name: `CLOUDFLARE_API_TOKEN`
- Secret: 粘贴您的API Token

**Secret 2:**
- Name: `CLOUDFLARE_ACCOUNT_ID`
- Secret: 粘贴您的Account ID

### 第5步：修改配置文件
1. 在您的仓库中编辑 `wrangler.toml` 文件
2. 修改以下内容：

```toml
name = "cf-ai-chat"
main = "src/worker.js"
compatibility_date = "2025-08-25"

[ai]
binding = "AI"

[[kv_namespaces]]
binding = "CHAT_HISTORY"
id = "您的KV命名空间ID"          # 替换这里
preview_id = "您的KV命名空间ID"   # 替换这里

[vars]
CHAT_PASSWORD = "您的访问密码"    # 修改这里
```

### 第6步：提交并部署
1. 提交更改
2. GitHub Actions会自动部署
3. 等待部署完成

## 🎯 部署完成后

### 访问应用
- Worker域名：`https://cf-ai-chat.您的账户名.workers.dev`
- 在Cloudflare Dashboard的Workers页面可以看到域名

### 首次使用
1. 打开Worker域名
2. 输入您在 `wrangler.toml` 中设置的密码
3. 选择AI模型
4. 开始聊天

## ⚠️ 重要声明

### 作者信息保护
本项目包含作者信息保护机制：
- **作者**：YouTube：康康的订阅天地
- **保护级别**：代码级别 + 前端验证
- **篡改后果**：服务将拒绝运行

**请勿修改、删除或篡改任何作者相关信息，否则服务将停止工作！**

## 🔧 重要配置说明

### wrangler.toml 配置
```toml
# Worker名称
name = "cf-ai-chat"

# 入口文件
main = "src/worker.js"

# 兼容性日期
compatibility_date = "2025-08-25"

# AI服务绑定
[ai]
binding = "AI"

# KV存储绑定（注意是双方括号）
[[kv_namespaces]]
binding = "CHAT_HISTORY"
id = "您的KV命名空间ID"
preview_id = "您的KV命名空间ID"

# 环境变量
[vars]
CHAT_PASSWORD = "您的密码"
```

### GitHub Secrets 说明
| Secret名称 | 说明 | 获取方式 |
|-----------|------|----------|
| `CLOUDFLARE_API_TOKEN` | API访问令牌 | [API Tokens页面](https://dash.cloudflare.com/profile/api-tokens) |
| `CLOUDFLARE_ACCOUNT_ID` | 账户ID | Dashboard右侧栏显示 |

## ❌ 常见错误

### 1. 部署失败
**错误**: `The field "kv_namespaces" should be an array`
**解决**: 确保使用 `[[kv_namespaces]]` 而不是 `[kv_namespaces]`

### 2. API Token无效
**错误**: `Authentication failed`
**解决**: 重新创建API Token，确保权限正确

### 3. KV命名空间不存在
**错误**: `KV namespace not found`
**解决**: 检查KV命名空间ID是否正确

### 4. 密码验证失败
**错误**: `密码错误`
**解决**: 检查 `wrangler.toml` 中的密码设置

## 📞 需要帮助？

如果遇到问题，请检查：
- [ ] KV命名空间ID是否正确
- [ ] GitHub Secrets是否设置正确
- [ ] wrangler.toml格式是否正确
- [ ] Cloudflare账户是否启用Workers AI

部署成功后，您就拥有了一个完整的AI聊天应用！🎉
