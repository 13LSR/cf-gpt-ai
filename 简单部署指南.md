# 🚀 CF AI Chat 简单部署指南

## ✅ 现在的正确架构
- **单一Worker部署** - 不需要分离前后端
- **模型配置写死在代码中** - 不需要环境变量配置模型
- **只需要一个密码** - 在wrangler.toml中设置

## 📋 必需的准备工作

### 1. GitHub仓库
- Fork本项目到您的GitHub账户

### 2. Cloudflare账户
- 确保已启用Workers AI功能
- 创建一个KV命名空间

### 3. 获取Cloudflare凭证
- **API Token**: [获取地址](https://dash.cloudflare.com/profile/api-tokens)
- **Account ID**: 在Dashboard右侧栏显示

## ⚙️ 配置步骤

### 第1步：修改wrangler.toml
```toml
name = "cf-ai-chat"
main = "src/worker.js"
compatibility_date = "2024-01-10"

[ai]
binding = "AI"

[[kv_namespaces]]  # 注意：这里是 [[]] 不是 []
binding = "CHAT_HISTORY"
id = "你的KV命名空间ID"          # 替换这里
preview_id = "你的KV命名空间ID"   # 替换这里

[vars]
CHAT_PASSWORD = "你的密码"        # 修改这里
```

### 第2步：配置GitHub Secrets
在仓库的 Settings > Secrets and variables > Actions 中添加：

- `CLOUDFLARE_API_TOKEN`: 您的API Token
- `CLOUDFLARE_ACCOUNT_ID`: 您的Account ID

### 第3步：提交代码
```bash
git add .
git commit -m "deploy cf ai chat"
git push
```

## 🎯 支持的模型

应用内置了6个AI模型，**不需要额外配置**：

| 模型 | 价格(输入/输出) | 上下文 | 适用场景 |
|------|----------------|--------|----------|
| DeepSeek-R1 | $0.50/$4.88 | 80K | 复杂推理 |
| GPT-OSS-120B | $0.35/$0.75 | 128K | 高性能通用 |
| GPT-OSS-20B | $0.20/$0.30 | 128K | 低成本日常 |
| Llama 4 Scout | $0.27/$0.85 | 131K | 多模态 |
| Qwen Coder | $0.66/$1.00 | 32K | 代码专用 |
| Gemma 3 | $0.35/$0.56 | 80K | 多语言 |

## 🚀 部署后使用

1. **访问应用**: 使用Worker的域名地址
2. **输入密码**: 使用wrangler.toml中设置的密码
3. **选择模型**: 从6个内置模型中选择
4. **开始聊天**: 输入问题，获得纯文本回复
5. **查看历史**: 自动保存在KV存储中

## ❌ 之前错误的地方

1. **wrangler.toml格式错误**: 
   - ❌ `[kv_namespaces]` 
   - ✅ `[[kv_namespaces]]`

2. **不需要的复杂架构**:
   - ❌ 前后端分离 + GitHub Pages
   - ✅ 单一Worker包含所有功能

3. **不需要的环境变量**:
   - ❌ MODEL_CONFIG环境变量
   - ✅ 模型配置直接写在代码中

## 🔧 故障排除

### 部署失败
1. 检查KV命名空间ID是否正确
2. 检查GitHub Secrets是否设置
3. 确认wrangler.toml格式正确

### 访问失败
1. 确认Worker已成功部署
2. 检查密码是否正确
3. 确认AI服务已启用

### 模型调用失败
1. 检查账户余额
2. 确认AI服务权限
3. 尝试不同的模型

## 📞 需要帮助？

如果仍有问题，请确认：
- [ ] KV命名空间已创建且ID正确
- [ ] wrangler.toml使用了 `[[kv_namespaces]]` 格式
- [ ] GitHub Secrets已正确设置
- [ ] Cloudflare账户已启用Workers AI
- [ ] 密码设置正确

这样部署就完成了！一个Worker搞定所有功能，简单可靠。
